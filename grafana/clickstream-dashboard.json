{
  "annotations": { "list": [] },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "links": [],
  "panels": [
    {
      "datasource": "Prometheus",
      "fieldConfig": { "defaults": {}, "overrides": [] },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 0 },
      "id": 1,
      "options": { "orientation": "auto", "showThresholdLabels": false, "showThresholdMarkers": true },
      "pluginVersion": "9.5.0",
      "targets": [
        { "expr": "up{job=~\"kafka|flink|redis|airflow-statsd\"}", "format": "time_series", "interval": "", "legendFormat": "{{job}}", "refId": "A" }
      ],
      "title": "Service Availability",
      "type": "gauge"
    },
    {
      "datasource": "Redis",
      "fieldConfig": { "defaults": {}, "overrides": [] },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 6 },
      "id": 2,
      "options": {},
      "pluginVersion": "9.5.0",
      "targets": [
        {
          "command": "HGETALL click_count:/home",
          "refId": "A",
          "type": "key-value"
        }
      ],
      "title": "Home Page Click Counts (Latest Minute)",
      "type": "table"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": { "defaults": {}, "overrides": [] },
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 0 },
      "id": 3,
      "targets": [
        {
          "expr": "rate(airflow_dag_run_total{dag_id=\"clickstream_pipeline\"}[1h]) - rate(airflow_dag_run_failed_total{dag_id=\"clickstream_pipeline\"}[1h])",
          "legendFormat": "Success Rate",
          "refId": "A"
        }
      ],
      "title": "Airflow DAG Success Rate (1h)",
      "type": "timeseries"
    },
    {
      "type": "graph",
      "title": "Fraud-Flag Throughput",
      "gridPos": { "x": 0, "y": 12, "w": 12, "h": 6 },
      "targets": [
        {
          "expr": "rate(flink_taskmanager_job_task_operator_flink_metrics_counter_flagged_sessions_total[1m])",
          "legendFormat": "flags/min"
        }
      ],
      "yaxes": [
        { "format": "ops", "min": 0 },
        { "format": "short" }
      ]
    },
    {
      "type": "graph",
      "title": "Pipeline Latency (P95)",
      "gridPos": { "x": 12, "y": 12, "w": 12, "h": 6 },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(flink_taskmanager_job_task_operator_flink_metrics_histogram_pipeline_latency_ms_bucket[5m])) by (le))",
          "legendFormat": "p95 latency"
        }
      ],
      "yaxes": [
        { "format": "ms", "min": 0 },
        { "format": "short" }
      ]
    }
  ],
  "schemaVersion": 36,
  "style": "dark",
  "tags": ["clickstream", "pipeline"],
  "templating": { "list": [] },
  "time": { "from": "now-1h", "to": "now" },
  "timepicker": {},
  "timezone": "",
  "title": "Clickstream Analytics Monitoring",
  "uid": null,
  "version": 1
}
